@baseUrl = http://localhost:8000
@token = test123

### =======================================================
### PHASE 1: SYSTEM & AUTHENTICATION
### =======================================================

### 1. Health Check (Used by DevOps/Kubernetes)
GET {{baseUrl}}/health

### 2. Verify Authentication (Middleware check)
GET {{baseUrl}}/me
Authorization: Bearer {{token}}

### =======================================================
### PHASE 2: JOB CREATION & KANBAN (SCRUM 24, 25, 26, 30)
### =======================================================

### 3. Create a New Job
# @name createJob
POST {{baseUrl}}/jobs/
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "customer_id": "cust-1",
    "part_id": "part-1",
    "quantity": 100,
    "received_date": "2026-02-25",
    "due_date": "2026-03-01",
    "priority": "HIGH"
}

### AUTOMATIC VARIABLE EXTRACTION (Do not click this line)
@job_id = {{createJob.response.body.$.job.job_id}}
@op_id = {{createJob.response.body.$.operations[0]}}

### 4. Get the Job Details
GET {{baseUrl}}/jobs/{{job_id}}
Authorization: Bearer {{token}}

### 5. View Kanban Board (Jobs grouped by stage)
GET {{baseUrl}}/jobs/by-stage
Authorization: Bearer {{token}}


### =======================================================
### PHASE 3: PLANNING & SCHEDULING (SCRUM 29)
### =======================================================

### 6. Assign the first operation to a Machine & Shift
PATCH {{baseUrl}}/job-operations/{{op_id}}/plan
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "machine_id": "machine-1",
    "shift_id": "shift-A",
    "planned_start_date": "2026-02-26T08:00:00",
    "planned_end_date": "2026-02-26T16:00:00"
}

### 7. View Planning Calendar (Gantt Chart Data)
GET {{baseUrl}}/planning/?machine_id=machine-1
Authorization: Bearer {{token}}


### =======================================================
### PHASE 4: EXECUTION & PRODUCTION (SCRUM 28, 31, 32)
### =======================================================

### 8. Start the Operation!
PATCH {{baseUrl}}/job-operations/{{op_id}}/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "status": "IN_PROGRESS"
}

### 9. Log Partial Production (Operator logging parts)
POST {{baseUrl}}/job-operations/{{op_id}}/production
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "produced_qty": 50,
    "scrap_qty": 2,
    "rework_qty": 0,
    "notes": "First batch running smooth"
}

### 10. Complete the Operation
PATCH {{baseUrl}}/job-operations/{{op_id}}/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "status": "COMPLETED",
    "quantity_completed": 50,
    "quantity_rejected": 0
}


### =======================================================
### PHASE 5: AUDIT, NOTIFICATIONS & METRICS (SCRUM 33)
### =======================================================

### 11. View Immutable Audit Trail
GET {{baseUrl}}/job-operations/{{op_id}}/audit
Authorization: Bearer {{token}}

### 12. Check Inbox (Should have a READY ping for Op 2!)
# @name getNotifs
GET {{baseUrl}}/notifications/
Authorization: Bearer {{token}}

### AUTOMATIC VARIABLE EXTRACTION
@notif_id = {{getNotifs.response.body.$.notifications[0].notification_id}}

### 13. Mark Notification as Read
PATCH {{baseUrl}}/notifications/{{notif_id}}/read
Authorization: Bearer {{token}}

### 14. Dashboard Metric: Work-In-Progress (WIP)
GET {{baseUrl}}/metrics/wip
Authorization: Bearer {{token}}

### 15. Dashboard Metric: Bottleneck Machines
GET {{baseUrl}}/metrics/bottlenecks
Authorization: Bearer {{token}}

### 16. Dashboard Metric: Late Jobs
GET {{baseUrl}}/metrics/late-jobs
Authorization: Bearer {{token}}